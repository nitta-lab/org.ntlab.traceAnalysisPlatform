<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.6"?>
<plugin>
   <extension-point id="additionalClasspaths" name="%ExtPoint.additionalClasspaths" schema="schema/additionalClasspaths.exsd"/>
	<!-- プロジェクト全体に対してインストゥルメンテーションを行う -->
	<extension
			point="org.eclipse.ui.commands">
		<category
				name="Analyzer Category"
				id="org.ntlab.traceAnalysisPlatform.commands.category">
		</category>
		<command
				name="Instrumentation Command"
				categoryId="org.ntlab.traceAnalysisPlatform.commands.category"
				id="org.ntlab.traceAnalysisPlatform.commands.instrumentation">
		</command>
	</extension>
	<extension
			point="org.eclipse.ui.handlers">
		<handler
				commandId="org.ntlab.traceAnalysisPlatform.commands.instrumentation"
				class="org.ntlab.traceAnalysisPlatform.handlers.InstrumentationHandler">
		</handler>
	</extension>
	<extension
			point="org.eclipse.ui.menus">
		<menuContribution
				locationURI="popup:org.eclipse.ui.popup.any?after=additions">
			<command
					commandId="org.ntlab.traceAnalysisPlatform.commands.instrumentation"
					id="org.ntlab.traceAnalysisPlatform.menus.instrumentation"
					label="Instrumentation">
				<visibleWhen>
					<with
							variable="selection">
						<iterate>
							<adapt
								type="org.eclipse.core.resources.IProject">
							</adapt>
						</iterate>
					</with>
				</visibleWhen>
			</command>
		</menuContribution>
	</extension>
	
	<!-- ロード時にトレーサを埋め込んで実行 -->
	<extension
		point="org.eclipse.debug.ui.launchShortcuts">
		<shortcut
			class="org.ntlab.traceAnalysisPlatform.ui.TracerLaunchShortcut"
			id="org.ntlab.traceAnalysisPlatform.launch.shortcut"
			label="Java Application with Tracer"
			modes="run, debug">
			<contextualLaunch>
				<enablement>
					<with variable="selection">
						<iterate>
							<and>
								<adapt type="org.eclipse.jdt.core.IJavaElement">
									<test property="org.eclipse.jdt.core.isInJavaProject"/>
								</adapt>
								<or>
									<test property="org.eclipse.jdt.launching.hasMain"/>
									<test property="org.eclipse.jdt.launching.isContainer"/>
									<test property="org.eclipse.jdt.launching.isPackageFragment"/>
									<test property="org.eclipse.jdt.launching.isPackageFragmentRoot"/>
								</or>
							</and>
						</iterate>
					</with>
				</enablement>
			</contextualLaunch>
		</shortcut>
	</extension>
	<extension
		point="org.eclipse.debug.core.launchConfigurationTypes">
		<launchConfigurationType
			delegate="org.ntlab.traceAnalysisPlatform.TracerLaunchConfigurationDelegate"
			id="org.ntlab.traceAnalysisPlatform.launchConfigurationType"
			migrationDelegate="org.eclipse.jdt.internal.launching.JavaMigrationDelegate"
			modes="run, debug"
			name="Java Application with Tracer"
			sourceLocatorId="org.eclipse.jdt.launching.javaSourceLocator"
			sourcePathComputerId="org.eclipse.jdt.launching.sourceLookup.javaSourcePathComputer">
		</launchConfigurationType>
	</extension>
	<extension
		point="org.eclipse.debug.ui.launchConfigurationTabGroups">
		<launchConfigurationTabGroup
			class="org.ntlab.traceAnalysisPlatform.ui.TracerLocalJavaApplicationTabGroup"
			helpContextId="org.eclipse.jdt.debug.ui.launchConfigHelpContext.local_java_application"
			id="org.ntlab.traceAnalysisPlatform.launchConfigurationTabGroup"
			type="org.ntlab.traceAnalysisPlatform.launchConfigurationType">
			<launchMode
				description="Java Application with Tracer"
				mode="run">
			</launchMode>
			<launchMode
				description="Java Application with Tracer"
				mode="debug">
			</launchMode>
		</launchConfigurationTabGroup>
	</extension>
</plugin>
